{"version":3,"file":"IndexCategoryTabs-573c220f.js","sources":["../../../../components/IndexCategoryTabs.vue"],"sourcesContent":["<template>\r\n    <div class=\"category-tablist\">\r\n\r\n        <div class=\"row\">\r\n            <div class=\"col-6\">\r\n                <ul class=\"nav nav-pills onmalika-index-categories mb-3\" id=\"pills-tab\" role=\"tablist\">\r\n                    <li class=\"nav-item\" v-for=\"(cat, index) in categories\" :key=\"cat.id\" role=\"presentation\">\r\n                        <button @click=\"loadProductsForCategory(cat, index)\" class=\"nav-link btn-success btn\"\r\n                            :class=\"{ 'active': index == 0 }\" :id=\"`pills-category-tab${index}`\" data-bs-toggle=\"pill\"\r\n                            :data-bs-target=\"`#pills-category${index}`\" type=\"button\" role=\"tab\"\r\n                            :aria-controls=\"`pills-category${index}`\" aria-selected=\"true\">{{ cat.name\r\n                            }}</button>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n        <div class=\"tab-content\" id=\"pills-tabContent\">\r\n            <div class=\"tab-pane fade\" :class=\"{ 'active show': index == 0 }\" v-for=\"(cat, index) in categories\"\r\n                :key=\"cat.id\" :id=\"`pills-category${index}`\" role=\"tabpanel\"\r\n                :aria-labelledby=\"`pills-category-tab${index}`\">\r\n                <div class=\"grid-parent\" v-if=\"cat && cat.productsLoaded && cat.products && cat.products.length > 0\">\r\n                    <div :class=\"'grid-' + number\" v-for=\"(product, number) in cat.products\" :key=\"product\">\r\n                        <MiniCard :product_info=\"product\" />\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n// Запрос категорий и продуктов для выбранной категории\r\nconst getCategoryId = ref(99);\r\nconst categories = ref([]);\r\n\r\nconst { data: getChosenCategory } = await useJsonPlaceholderData('/categories/?parent=' + getCategoryId.value);\r\nif (getChosenCategory && getChosenCategory.value && getChosenCategory.value.results) {\r\n    const productsRequests = getChosenCategory.value.results.map(category =>\r\n        useJsonPlaceholderData(`/products/?category=${category.id}&limit=7`).then(response => {\r\n            category.products = response.data.value;\r\n            return category;\r\n        })\r\n    );\r\n    const categoriesWithProducts = await Promise.all(productsRequests);\r\n    categories.value = categoriesWithProducts; // Теперь categories содержит категории с товарами\r\n    \r\n}\r\nconst loadProductsForCategory = async (category, index) => {\r\n    if (!category.productsLoaded) {\r\n        try {\r\n            // Выполнение запроса для загрузки продуктов выбранной категории\r\n            const response = await useJsonPlaceholderData(`/products/?category=${category.id}&limit=7`);\r\n\r\n            // Проверка на наличие ожидаемых данных в ответе\r\n            if (response && response.data && response.data.value && response.data.value.results) {\r\n                // Создание копии категории с новыми данными о продуктах и отметкой о загрузке\r\n                const updatedCategory = {\r\n                    ...category,\r\n                    products: response.data.value.results,\r\n                    productsLoaded: true,\r\n                };\r\n\r\n                // Обновление категории в массиве с обеспечением реактивности\r\n                categories.value = categories.value.map((cat, catIndex) =>\r\n                    catIndex === index ? updatedCategory : cat\r\n                );\r\n            } else {\r\n                // Логирование в случае отсутствия ожидаемых данных\r\n                console.error('Полученный ответ не содержит ожидаемых данных:', response);\r\n            }\r\n        } catch (error) {\r\n            // Логирование ошибки запроса\r\n            console.error('Ошибка при загрузке продуктов для категории:', error);\r\n        }\r\n    }\r\n};\r\nonMounted(() => {\r\n    setTimeout(() => {\r\n        loadProductsForCategory(categories.value[0], 0);\r\n    }, 500); \r\n});\r\n\r\n\r\n</script>\r\n"],"names":["_withAsyncContext"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA,UAAM,gBAAgB,IAAI,EAAE;AAC5B,UAAM,aAAa,IAAI,CAAA,CAAE;AAEzB,UAAM,EAAE,MAAM,kBAAmB,KAAG,CAAA,QAAA,SAAA,IAAAA,iBAAA,MAAM,uBAAuB,yBAAyB,cAAc,KAAK,CAAA;AAC7G,QAAI,qBAAqB,kBAAkB,SAAS,kBAAkB,MAAM,SAAS;AACjF,YAAM,mBAAmB,kBAAkB,MAAM,QAAQ;AAAA,QAAI,cACzD,uBAAuB,uBAAuB,SAAS,EAAE,UAAU,EAAE,KAAK,cAAY;AAClF,mBAAS,WAAW,SAAS,KAAK;AAClC,iBAAO;AAAA,QACnB,CAAS;AAAA,MACT;AACI,YAAM,0BAA+B,CAAA,QAAA,SAAA,IAAAA,iBAAA,MAAA,QAAQ,IAAI,gBAAgB,CAAA;AACjE,iBAAW,QAAQ;AAAA,IAEvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}